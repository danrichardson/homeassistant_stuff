- id: '1747197008762'
  alias: 3am Battery Precharge Calculation - AC300
  description: ''
  triggers:
  - at: 03:00:00
    trigger: time
  - at: 04:00:00
    trigger: time
  - at: 05:00:00
    trigger: time
  - at: 06:00:00
    trigger: time
  - entity_id: sensor.energy_production_today_remaining
    trigger: state
  conditions:
  - condition: template
    value_template: '{{ now().weekday() in [0, 1, 2, 3, 4] and now().hour < 16 and
      now().hour > 3 }}'
  actions:
  - data: {}
    action: script.set_target_soc
  - variables:
      current_soc: '{{ states(''sensor.available_battery_kwh'') | float }}'
      solar_forecast: '{{ states(''sensor.energy_production_today_remaining'') | float
        }}'
      required_energy: '{{ states(''input_number.required_energy_today'') | float
        }}'
      target_soc: '{{ states(''input_number.target_soc_kwh'') | float }}'
  - choose:
    - conditions:
      - condition: template
        value_template: '{{ target_soc > current_soc }}'
      sequence:
      - data:
          title: Battery Charging Plan
          message: 'Charging required:  - SOC: {{ current_soc | round(1) }} kWh  -
            Forecast: {{ solar_forecast | round(1) }} kWh - Required: {{ required_energy
            | round(1) }} kWh  - Target: {{ target_soc | round(1) }} kWh

            '
        action: notify.mobile_app_phonetonia
      - data:
          option: STANDARD
        target:
          entity_id:
          - select.ac300_ups_mode
        action: select.select_option
    default:
    - sequence:
      - data:
          title: Battery Charging Plan
          message: 'Charging NOT required:  - SOC: {{ current_soc | round(1) }} kWh  -
            Forecast: {{ solar_forecast | round(1) }} kWh - Required: {{ required_energy
            | round(1) }} kWh - Target: {{ target_soc | round(1) }} kWh - Triggered
            by {{ trigger.platform }} on {{ trigger.entity_id or ''time'' }}

            '
        action: notify.mobile_app_phonetonia
        enabled: false
      - data:
          option: PV_PRIORITY
        target:
          entity_id:
          - select.ac300_ups_mode
        action: select.select_option
  mode: single
- id: '1747426733415'
  alias: Inverter overloading - AC300
  description: ''
  triggers:
  - trigger: numeric_state
    entity_id:
    - sensor.ac300_ac_output_power
    for:
      hours: 0
      minutes: 0
      seconds: 1
    above: 2900
  conditions: []
  actions:
  - device_id: aea9d40bb10539ffe3160c852f70d775
    domain: mobile_app
    type: notify
    message: Shut something down quick!
    title: Inverter Overloading!
  mode: single
- id: '1747426972396'
  alias: Power Spiking During Peak
  description: ''
  triggers:
  - trigger: numeric_state
    entity_id:
    - sensor.vuetonia_123_1min
    for:
      hours: 0
      minutes: 0
      seconds: 10
    above: 1400
  conditions:
  - condition: time
    after: '17:00:00'
    before: '21:00:00'
    weekday:
    - mon
    - tue
    - wed
    - thu
    - fri
  actions:
  - action: notify.mobile_app_phonetonia
    metadata: {}
    data:
      title: Power is spiking during Peak
      message: Do you really want to do that?
  - action: tts.speak
    target:
      entity_id: tts.piper
    data:
      cache: true
      media_player_entity_id: media_player.kitchen_front
      message: Power is spiking during Peak. Do you really want to do that?
  mode: single
- id: '1747427915822'
  alias: Kitchen Overloading
  description: ''
  triggers:
  - trigger: numeric_state
    entity_id:
    - sensor.kitchen_13_1min
    for:
      hours: 0
      minutes: 0
      seconds: 1
    above: 2000
  conditions: []
  actions:
  - device_id: aea9d40bb10539ffe3160c852f70d775
    domain: mobile_app
    type: notify
    message: Shut something down quick!
    title: Kitchen Overloading!
  mode: single
- id: '1748728948910'
  alias: 3am Battery Precharge Calculation - AC500
  description: ''
  triggers:
  - at: 03:00:00
    trigger: time
  - at: 04:00:00
    trigger: time
  - at: 05:00:00
    trigger: time
  - at: 06:00:00
    trigger: time
  - entity_id:
    - sensor.solcast_pv_forecast_forecast_remaining_today
    trigger: state
  conditions:
  - condition: template
    value_template: '{{ now().weekday() in [0, 1, 2, 3, 4] and now().hour < 16 and
      now().hour > 3 }}'
  actions:
  - data: {}
    action: script.set_target_soc
  - variables:
      current_soc: '{{ states(''sensor.available_battery_kwh'') | float }}'
      solar_forecast: '{{ states(''sensor.solcast_pv_forecast_forecast_remaining_today'')
        | float }}'
      required_energy: '{{ states(''input_number.required_energy_today'') | float
        }}'
      target_soc: '{{ states(''input_number.target_soc_kwh'') | float }}'
  - choose:
    - conditions:
      - condition: template
        value_template: '{{ target_soc > current_soc }}'
      sequence:
      - data:
          title: Battery Charging Plan
          message: 'Charging required:  - SOC: {{ current_soc | round(1) }} kWh  -
            Forecast: {{ solar_forecast | round(1) }} kWh - Required: {{ required_energy
            | round(1) }} kWh  - Target: {{ target_soc | round(1) }} kWh

            '
        action: notify.mobile_app_phonetonia
      - data:
          option: STANDARD
        target:
          entity_id: select.ac500_ups_mode
        action: select.select_option
    default:
    - sequence:
      - data:
          title: Battery Charging Plan
          message: 'Charging NOT required:  - SOC: {{ current_soc | round(1) }} kWh  -
            Forecast: {{ solar_forecast | round(1) }} kWh - Required: {{ required_energy
            | round(1) }} kWh - Target: {{ target_soc | round(1) }} kWh - Triggered
            by {{ trigger.platform }} on {{ trigger.entity_id or ''time'' }}

            '
        action: notify.mobile_app_phonetonia
        enabled: false
      - data:
          option: PV_PRIORITY
        target:
          entity_id: select.ac500_ups_mode
        action: select.select_option
  mode: single
- id: '1748729056247'
  alias: Inverter Overloading AC500
  description: ''
  triggers:
  - trigger: numeric_state
    entity_id:
    - sensor.ac500_ac_output_power
    for:
      hours: 0
      minutes: 0
      seconds: 1
    above: 4900
  conditions: []
  actions:
  - device_id: aea9d40bb10539ffe3160c852f70d775
    domain: mobile_app
    type: notify
    message: Shut something down quick!
    title: Inverter Overloading!
  mode: single
